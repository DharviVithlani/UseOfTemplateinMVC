@{
    ViewBag.Title = "ForgotPassword";
    Layout = null;
}
<link href="~/CSS/fontawesome-free/css/all.min.css" rel="stylesheet" />
<link href="~/CSS/toastr.min.css" rel="stylesheet" />
<link href="~/CSS/adminlte.min.css" rel="stylesheet" />
<link href="~/CSS/sweetalert2.min.css" rel="stylesheet" />
<body class="hold-transition login-page">
    <div class="login-box">
        <div class="login-logo">
            <a><b>Admin</b>LTE</a>
        </div>
        <div class="card">
            <div class="overlay" style="display:none">
                <i class="fas fa-2x fa-sync-alt fa-spin"></i>
            </div>
            <div class="card-body login-card-body">
                <form id="quickForm">
                    <p class="login-box-msg">To Recover your Password Enter Your UserName below and click on Send.</p>
                    <div class="form-group">
                        @Html.Editor("username", new { htmlAttributes = new { @class = "form-control", placeholder = "Username", @id = "txtusername" } })
                    </div>

                    <div class="text-center">
                        <input type="submit" value="Send" class="btn btn-primary btn-block" />
                    </div>
                </form>
                <p class="mt-3 mb-1">
                    @Html.ActionLink("Login", "LoginV2", "LoginV2")
                </p>
                <p class="mb-0">
                    @Html.ActionLink("Register a new membership", "NewRegistration", "Registration")
                </p>
            </div>
        </div>
    </div>
</body>
<div class="modal fade" id="modal-ForgotPassword">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Forgot Password</h4>
            </div>
            <div class="modal-body m-3">
                Your password has been successfully sent to your Email Address(<label id="lblusername"></label>). Please check.
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-primary" onclick="location.href='@Url.Action("LoginV2","LoginV2")'">Ok</a>
            </div>
        </div>
    </div>
</div>
@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/jqueryval")
<script src="~/Scripts/toastr.min.js"></script>
<script src="~/Scripts/Layoutpage/bootstrap.bundle.min.js"></script>
<script src="~/Scripts/loader.js"></script>
<script src="~/Scripts/sweetalert2.min.js"></script>
<script type="text/javascript">
    $(function () {
        $.validator.setDefaults({
            submitHandler: function () {
                var userName = $("#txtusername").val();
                $.ajax({
                    type: "POST",
                    url: "/ForgotPassword/ForgotPassword",
                    beforeSend: function () { loader.show() },
                    data: {
                        username: userName
                    },
                    success: function (showPopup) {
                        loader.hide();
                        if (!showPopup) {
                            toastr.error("Your Username is not exists in our system. Please create an account.")
                        }
                        else {
                            Swal.fire(
                                'Email sent!',
                                'Please check your Email [' + userName + ']!',
                                'success'
                            ).then(function () {
                                window.location = "/LoginV2/LoginV2";
                            });
                            // $("#lblusername").text(userName);
                            // $("#modal-ForgotPassword").modal('show');
                        }
                    }
                })
            }
        })
        $('#quickForm').validate({
            rules: {
                username: {
                    required: true,
                }
            },
            messages: {
                username: {
                    required: "Username is required.",
                }
            },
            errorElement: 'span',
            errorPlacement: function (error, element) {
                error.addClass('invalid-feedback');
                element.closest('.form-group').append(error);
            },
            highlight: function (element, errorClass, validClass) {
                $(element).addClass('is-invalid');
            },
            unhighlight: function (element, errorClass, validClass) {
                $(element).removeClass('is-invalid');
            }
        });
    });
</script>


